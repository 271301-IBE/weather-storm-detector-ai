{% extends "base.html" %}

{% block title %}Weather Storm Detection - Dashboard{% endblock %}

{% block content %}
<div id="dashboard-content">
    <!-- ƒåHM√ö Warnings - Full Width at Top -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-warning">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">‚ö†Ô∏è ƒåHM√ö Meteorologick√° Varov√°n√≠ - Brno</h5>
                </div>
                <div class="card-body" id="chmiWarnings">
                    <p class="text-center">Loading warnings...</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">Current Weather üå§Ô∏è</div>
                <div class="card-body" id="currentWeather">
                    <p class="text-center">Loading weather data...</p>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">System Stats (24h) üìä</div>
                <div class="card-body" id="systemStats">
                    <p class="text-center">Loading statistics...</p>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">Next Predicted Storm ‚õàÔ∏è</div>
                <div class="card-body" id="nextStormPrediction">
                    <p class="text-center">Loading prediction...</p>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">Recent AI Analysis ü§ñ</div>
                <div class="card-body" id="recentAnalysis">
                    <p class="text-center">Loading analysis data...</p>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">Lightning Stats ‚ö°</div>
                <div class="card-body" id="lightningStats">
                    <p class="text-center">Loading lightning stats...</p>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header">Weather Trends (24h) üìà</div>
                <div class="card-body">
                    <canvas id="weatherChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <span>Next 6 Hours Forecast üîÆ</span>
                        <div>
                            <span class="badge bg-info me-2" id="forecastMethod">Loading...</span>
                            <span class="badge bg-secondary" id="forecastConfidence">Confidence: --</span>
                            <small class="text-muted ms-2" id="forecastLastUpdated">Last updated: --</small>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Method Selector Tabs -->
                    <ul class="nav nav-tabs mb-3" id="forecastTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="ensemble-tab" data-bs-toggle="tab" data-bs-target="#ensemble-pane" type="button" role="tab">
                                üéØ Ensemble (Best)
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="ai-tab" data-bs-toggle="tab" data-bs-target="#ai-pane" type="button" role="tab">
                                ü§ñ AI Prediction
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="physics-tab" data-bs-toggle="tab" data-bs-target="#physics-pane" type="button" role="tab">
                                üßÆ Local Physics
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="comparison-tab" data-bs-toggle="tab" data-bs-target="#comparison-pane" type="button" role="tab">
                                üìä Compare All
                            </button>
                        </li>
                    </ul>

                    <!-- Tab Content -->
                    <div class="tab-content" id="forecastTabContent">
                        <!-- Ensemble Forecast -->
                        <div class="tab-pane fade show active" id="ensemble-pane" role="tabpanel">
                            <div class="alert alert-success" role="alert">
                                <strong>üéØ Ensemble Forecast:</strong> Best predictions combining AI analysis, atmospheric physics, and machine learning
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead class="table-success">
                                        <tr>
                                            <th>Time</th>
                                            <th>Temp (¬∞C)</th>
                                            <th>Humidity (%)</th>
                                            <th>Pressure (hPa)</th>
                                            <th>Wind (m/s)</th>
                                            <th>Precip (mm)</th>
                                            <th>Precip Prob (%)</th>
                                            <th>Condition</th>
                                            <th>Confidence</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ensembleForecastBody">
                                        {% if forecast_data and forecast_data.ensemble and forecast_data.ensemble.forecast %}
                                            {% for item in forecast_data.ensemble.forecast %}
                                            <tr>
                                                <td><strong>{{ item.timestamp }}</strong></td>
                                                <td>{{ item.temperature }}¬∞C</td>
                                                <td>{{ item.humidity }}%</td>
                                                <td>{{ item.pressure }}</td>
                                                <td>{{ item.wind_speed }}</td>
                                                <td>{{ item.precipitation }}</td>
                                                <td>{{ item.precipitation_probability }}%</td>
                                                <td>
                                                    <span class="badge bg-light text-dark">{{ item.condition }}</span>
                                                </td>
                                                <td><span class="badge bg-success">{{ item.confidence }}%</span> <span class="badge bg-secondary">{{ item.confidence_level }}</span></td>
                                            </tr>
                                            {% endfor %}
                                        {% else %}
                                        <tr>
                                            <td colspan="9" class="text-center">Loading ensemble forecast...</td>
                                        </tr>
                                        {% endif %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- AI Forecast -->
                        <div class="tab-pane fade" id="ai-pane" role="tabpanel">
                            <div class="alert alert-info" role="alert">
                                <strong>ü§ñ AI Prediction:</strong> DeepSeek AI analysis using meteorological patterns and current conditions
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead class="table-info">
                                        <tr>
                                            <th>Time</th>
                                            <th>Temp (¬∞C)</th>
                                            <th>Humidity (%)</th>
                                            <th>Pressure (hPa)</th>
                                            <th>Wind (m/s)</th>
                                            <th>Precip (mm)</th>
                                            <th>Precip Prob (%)</th>
                                            <th>Condition</th>
                                            <th>Confidence</th>
                                        </tr>
                                    </thead>
                                    <tbody id="aiForecastBody">
                                        {% if forecast_data and forecast_data.ai and forecast_data.ai.forecast %}
                                            {% for item in forecast_data.ai.forecast %}
                                            <tr>
                                                <td><strong>{{ item.timestamp }}</strong></td>
                                                <td>{{ item.temperature }}¬∞C</td>
                                                <td>{{ item.humidity }}%</td>
                                                <td>{{ item.pressure }}</td>
                                                <td>{{ item.wind_speed }}</td>
                                                <td>{{ item.precipitation }}</td>
                                                <td>{{ item.precipitation_probability }}%</td>
                                                <td>
                                                    <span class="badge bg-light text-dark">{{ item.condition }}</span>
                                                </td>
                                                <td><span class="badge bg-info">{{ item.confidence }}%</span> <span class="badge bg-secondary">{{ item.confidence_level }}</span></td>
                                            </tr>
                                            {% endfor %}
                                        {% else %}
                                        <tr>
                                            <td colspan="9" class="text-center">Loading AI forecast...</td>
                                        </tr>
                                        {% endif %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Physics Forecast -->
                        <div class="tab-pane fade" id="physics-pane" role="tabpanel">
                            <div class="alert alert-warning" role="alert">
                                <strong>üßÆ Local Physics:</strong> Atmospheric physics calculations and mathematical trend analysis
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead class="table-warning">
                                        <tr>
                                            <th>Time</th>
                                            <th>Temp (¬∞C)</th>
                                            <th>Humidity (%)</th>
                                            <th>Pressure (hPa)</th>
                                            <th>Wind (m/s)</th>
                                            <th>Precip (mm)</th>
                                            <th>Precip Prob (%)</th>
                                            <th>Condition</th>
                                            <th>Confidence</th>
                                        </tr>
                                    </thead>
                                    <tbody id="physicsForecastBody">
                                        {% if forecast_data and forecast_data.physics and forecast_data.physics.forecast %}
                                            {% for item in forecast_data.physics.forecast %}
                                            <tr>
                                                <td><strong>{{ item.timestamp }}</strong></td>
                                                <td>{{ item.temperature }}¬∞C</td>
                                                <td>{{ item.humidity }}%</td>
                                                <td>{{ item.pressure }}</td>
                                                <td>{{ item.wind_speed }}</td>
                                                <td>{{ item.precipitation }}</td>
                                                <td>{{ item.precipitation_probability }}%</td>
                                                <td>
                                                    <span class="badge bg-light text-dark">{{ item.condition }}</span>
                                                </td>
                                                <td><span class="badge bg-warning">{{ item.confidence }}%</span> <span class="badge bg-secondary">{{ item.confidence_level }}</span></td>
                                            </tr>
                                            {% endfor %}
                                        {% else %}
                                        <tr>
                                            <td colspan="9" class="text-center">Loading physics forecast...</td>
                                        </tr>
                                        {% endif %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Comparison View -->
                        <div class="tab-pane fade" id="comparison-pane" role="tabpanel">
                            <div class="alert alert-secondary" role="alert">
                                <strong>üìä Method Comparison:</strong> Side-by-side comparison of all forecasting approaches
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover table-sm">
                                    <thead class="table-dark">
                                        <tr>
                                            <th rowspan="2">Time</th>
                                            <th colspan="3" class="text-center">Temperature (¬∞C)</th>
                                            <th colspan="3" class="text-center">Humidity (%)</th>
                                            <th colspan="3" class="text-center">Pressure (hPa)</th>
                                        </tr>
                                        <tr>
                                            <th class="text-success">Ensemble</th>
                                            <th class="text-info">AI</th>
                                            <th class="text-warning">Physics</th>
                                            <th class="text-success">Ensemble</th>
                                            <th class="text-info">AI</th>
                                            <th class="text-warning">Physics</th>
                                            <th class="text-success">Ensemble</th>
                                            <th class="text-info">AI</th>
                                            <th class="text-warning">Physics</th>
                                        </tr>
                                    </thead>
                                    <tbody id="comparisonForecastBody">
                                        {% if forecast_data and forecast_data.ensemble and forecast_data.ensemble.forecast %}
                                            {% for i in range(forecast_data.ensemble.forecast|length) %}
                                            <tr>
                                                <td><strong>{{ forecast_data.ensemble.forecast[i].timestamp }}</strong></td>
                                                <td class="text-success">{{ forecast_data.ensemble.forecast[i].temperature if forecast_data.ensemble else '--' }}</td>
                                                <td class="text-info">{{ forecast_data.ai.forecast[i].temperature if forecast_data.ai else '--' }}</td>
                                                <td class="text-warning">{{ forecast_data.physics.forecast[i].temperature if forecast_data.physics else '--' }}</td>
                                                <td class="text-success">{{ forecast_data.ensemble.forecast[i].humidity if forecast_data.ensemble else '--' }}</td>
                                                <td class="text-info">{{ forecast_data.ai.forecast[i].humidity if forecast_data.ai else '--' }}</td>
                                                <td class="text-warning">{{ forecast_data.physics.forecast[i].humidity if forecast_data.physics else '--' }}</td>
                                                <td class="text-success">{{ forecast_data.ensemble.forecast[i].pressure if forecast_data.ensemble else '--' }}</td>
                                                <t class="text-info">{{ forecast_data.ai.forecast[i].pressure if forecast_data.ai else '--' }}</td>
                                                <td class="text-warning">{{ forecast_data.physics.forecast[i].pressure if forecast_data.physics else '--' }}</td>
                                            </tr>
                                            {% endfor %}
                                        {% else %}
                                        <tr>
                                            <td colspan="10" class="text-center">Loading comparison data...</td>
                                        </tr>
                                        {% endif %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Forecast Metadata -->
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="card bg-light">
                                <div class="card-body p-2">
                                    <h6 class="card-title mb-1">üîç Method Details</h6>
                                    <div id="methodDetails">
                                        <small class="text-muted">Select a forecast method to see details</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card bg-light">
                                <div class="card-body p-2">
                                    <h6 class="card-title mb-1">üìà Accuracy Stats</h6>
                                    <div id="accuracyStats">
                                        <small class="text-muted">Recent forecast accuracy information</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">API Usage Stats üîó</div>
                <div class="card-body" id="apiUsageStats">
                    <p class="text-center">Loading API usage...</p>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">Combined Weather Data ‚öñÔ∏è</div>
                <div class="card-body" id="weatherAverages">
                    <p class="text-center">Loading averages...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="history-content" style="display:none;">
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header">Historical Weather Data üï∞Ô∏è</div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="historyTimeline" class="form-label">Select Timeline:</label>
                        <select class="form-select" id="historyTimeline">
                            <option value="24">Last 24 Hours</option>
                            <option value="72">Last 3 Days</option>
                            <option value="168">Last 7 Days</option>
                            <option value="720">Last 30 Days</option>
                        </select>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="history-chart-container">
                                <canvas id="historyChartTemperature"></canvas>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="history-chart-container">
                                <canvas id="historyChartHumidity"></canvas>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="history-chart-container">
                                <canvas id="historyChartPressure"></canvas>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="history-chart-container">
                                <canvas id="historyChartWindSpeed"></canvas>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="history-chart-container">
                                <canvas id="historyChartPrecipitation"></canvas>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="history-chart-container">
                                <canvas id="historyChartPrecipitationProbability"></canvas>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="history-chart-container">
                                <canvas id="historyChartCombined"></canvas>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="history-chart-container">
                                <canvas id="historyChartWindPrecipitation"></canvas>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="history-chart-container">
                                <canvas id="historyChartPrecipitationProbabilityCombined"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

